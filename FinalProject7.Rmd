---
title: "FinalProject7.Rmd"
author: "Dana Thacker, Nikole Slinger, Andrew Fahmy, Julia Lundstrum, Zack Larson"
date: "4/19/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

1 - Nikole
2 - Julia
3 - Dana
4 - Zack
5 - Zack
6 - Nikole
7 - Dana
8 - Andrew

```{r, warning = FALSE, message = FALSE}
library(ggplot2)
library(tidyverse)
library(readxl)

raw_data <- readxl::read_xlsx("2021VaccineCovidData.xlsx", sheet='raw_data')
VAERSdata <- readxl::read_xlsx("2021VaccineCovidData.xlsx", sheet='2021VAERSDATA')
VAERSsymptoms <- readxl::read_xlsx("2021VaccineCovidData.xlsx", sheet='2021VAERSSymptoms')
VAERSVax <- readxl::read_xlsx("2021VaccineCovidData.xlsx", sheet='2021VAERSVax')
state <- map_data("state")
```

**1. What's the most common symptom to experience for each manufacturer?**
```{r}
# joining vax and symptom data, only need id, vaccine manu, and symptoms
symptoms <- VAERSVax %>% full_join(VAERSsymptoms, by = 'VAERS_ID') %>%
  filter(VAX_TYPE == 'COVID19') %>%
  select(VAERS_ID, VAX_MANU, SYMPTOM1, SYMPTOM2, SYMPTOM3, SYMPTOM4, SYMPTOM5)

```

**2. Compare Covid case cases per state in contrast to the number of vaccines administered by state**
```{r}

```

**3. Compare a patient's medical history with their symptoms from the vaccine they received. Dana**
```{r}
#Join VAERSsymptoms and VAERSdata
medHist <- VAERSsymptoms %>% full_join(VAERSdata) %>%
  select(VAERS_ID, SYMPTOM1, SYMPTOM2, SYMPTOM3, SYMPTOM4, SYMPTOM5, HISTORY) %>%
  separate(HISTORY, c('history1', 'history2'), sep = ', ') %>%
  filter(history1 %in% c('None', 'none', 'anxiexy', 'depression', 'Anxiety', 'Depression', 'obesity', 'Obesity',
                         'hypertension', 'Hypertension', 'hypothyroidism', 'Hypothyroidism', 'asthma', 'Asthma',
                         'anorexia', 'Anorexia', 'osteoarthritis', 'Osteoarthritis', 'PTSD', 'migraines', 'Migraines', 'NA',
                         'No', 'N/A', 'n/a', 'High blood pressure') & history2 %in% c('None', 'none', 'anxiexy',
                          'depression', 'Anxiety', 'Depression', 'obesity', 'Obesity',
                          'hypertension', 'Hypertension', 'hypothyroidism', 'Hypothyroidism', 'asthma', 'Asthma',
                         'anorexia', 'Anorexia', 'osteoarthritis', 'Osteoarthritis', 'PTSD', 'migraines', 'Migraines', 'NA',
                         'No', 'N/A', 'n/a', 'High blood pressure'))

nausea <- medHist %>%
  filter(SYMPTOM1 == 'Nausea' | SYMPTOM2 == 'Nausea' | SYMPTOM3 == 'Nausea' | SYMPTOM4 == 'Nausea' | SYMPTOM5 == 'Nausea')
```

**4. Which states have the highest and lowest number of Covid cases and fatality rate?**
```{r}

```

**5. What patterns are shown when looking at a patient's death (post vaccine) and the reasons why they might have died?**
```{r}

```

**6. What age group has gotten the most vaccines?**
```{r}
# joining general patient data and vax data
age <- VAERSdata %>% full_join(VAERSVax, by = 'VAERS_ID') %>%
  select(VAERS_ID, VAX_MANU, AGE_YRS)
# adding 10 year age group column to sort ages
age <- age %>%
  mutate(AGE_GROUP = ifelse(AGE_YRS %in% 0:18, '0 to 18',
                     ifelse(AGE_YRS %in% 19:29, '19 to 29',
                     ifelse(AGE_YRS %in% 30:49, '30 to 39',
                     ifelse(AGE_YRS %in% 40:49, '40 to 49',
                     ifelse(AGE_YRS %in% 50:59, '50 to 59',
                     ifelse(AGE_YRS %in% 60:69, '60 to 69', 
                     ifelse(AGE_YRS %in% 70:79, '70 to 79', 
                     ifelse(AGE_YRS %in% 80:89, '80 to 89', 'Over 90')))))))))
# plotting visual representation
ggplot(age, aes(x = AGE_GROUP)) + geom_bar(fill = 'steelblue') +
  ggtitle('Number of Vaccinations per Age Groups') +
  xlab('Age Group (years)') + ylab('Count')
# numerical stats
table(age$AGE_GROUP)
```

**7. What is the most popular vaccine manufacturer per state? Dana**
```{r}
perState <- VAERSVax %>% full_join(VAERSdata) %>%
  select(VAERS_ID, STATE, VAX_MANU) %>%
  group_by(STATE, VAX_MANU) %>%
  summarise(popular = n())

topPerState <- top_n(perState, 1) %>%
  select(-popular)
head(topPerState, 10)

ggplot(topPerState, aes(x = VAX_MANU)) + geom_bar() + xlab("Top Vaccine Manufacturers") + ylab("Number of States") + ggtitle("Number of States with Each Vaccine as the Most Distributed Vaccine")
```

The most widely administered vaccine in any given state from the beginning of vaccine administering through March 19, 2021 is either Moderna or Pfizer/Biontech. The most popular vaccine in Iowa as of March 19 was Moderna. Pfizer/Biontech is slightly more common as the most popular vaccine as it was the most popular in 32 states or regions and Moderna was the most popular in 32. 

**8. Is there a trend on the number of vaccines administered per day? By state and nation wide?**
```{r}

```
